## Инструкция по сборке и запуску Docker-контейнера
cd tbank-logo-api
docker build -t tbank-detector .
docker run -p 8000:8000 --gpus all tbank-detector
Откройте браузер и перейдите по адресу:
http://localhost:8000/docs


## Подход к решению

Для автоматической разметки данных использовалась комбинация моделей **GroundingDINO** и **FastSAM**. Изначально была протестирована связка GroundingDINO с оригинальной моделью Segment Anything (SAM), которая позволяла получать высокоточные маски объектов. Однако инференс такой системы занимал более 3 секунд на одно изображение, что делало её непрактичной для обработки большого объёма данных.

В качестве альтернативы была выбрана модель FastSAM, которая обеспечивает сопоставимое качество сегментации при значительно более высокой скорости обработки. FastSAM позволяет находить точные маски по текстовому описанию, что позволило использовать запрос "coat of arms with the letter T in the center" для детекции интересующего объекта.

Для фильтрации найденных масок и выделения именно логотипа Т-Банка (стилизованная буква "Т" в щите) была реализована дополнительная функция анализа формы контура. Она включала следующие этапы:
1. Аппроксимация контура до многоугольника.
2. Проверка наличия пятиугольной формы.
3. Определение острого угла в нижней вершине щита.
4. Анализ симметрии контура относительно вертикальной оси.

Этот подход позволил эффективно отделять целевой логотип от других объектов, похожих по цвету или форме.

### Дополнительные методы сравнения контуров

Для повышения точности разметки были исследованы альтернативные методы:
1. Сравнение с эталонным контуром: был выделен образец логотипа с одного изображения, и все найденные маски сравнивались с ним.
2. Методы сравнения контуров с помощью библиотеки OpenCV (cv2.matchShapes).
3. Сравнение контуров с использованием **метода моментов Фурье** (Fourier Descriptors), обеспечивающего частичную инвариантность к масштабу и повороту.

Однако эти методы оказались чувствительными к изменениям масштаба, ракурса и степени детализации маски, что ограничило их применимость. На практике они не превзошли по качеству комбинацию GroundingDINO + FastSAM с геометрической фильтрацией.

### Оптимизация скорости обработки

Для ускорения обработки большого количества изображений:
- Обнаруженные bounding box'ы от GroundingDINO передавались в FastSAM пакетами.
- Анализ формы выполнялся только для релевантных кандидатов, отобранных по размеру и положению.
- Весь процесс автоматизации был распараллелен и запущен на GPU.

В результате удалось разметить **25 000 изображений**, из которых **5 000 содержали логотип Т-Банка**. Все аннотации были сохранены в формате YOLO (.txt), совместимом с Ultralytics.

### Балансировка выборки

Для предотвращения дисбаланса классов при обучении использовалась сбалансированная выборка:
- Все 5 000 изображений с логотипом.
- 5 000 случайно выбранных изображений без логотипа (negative examples).

Такой подход помог модели научиться не только находить логотип, но и корректно игнорировать похожие объекты, включая логотипы "Тинькофф".

### Обучение модели

Обучение проводилось с использованием **YOLOv8s** (Ultralytics). Модель была дообучена на подготовленной выборке в течение **50 эпох**. Из-за ограниченного времени не удалось провести полный анализ качества разметки (например, через Roboflow), что могло бы повысить метрики за счёт исправления ошибок в аннотациях.

Основная метрика качества — **mAP@0.5** — достигла значения **65%** на валидационной выборке. Это значение может быть улучшено за счёт:
- Дообучения на очищенной разметке
- Аугментации сложных случаев (мелкие логотипы, нестандартные ракурсы)
